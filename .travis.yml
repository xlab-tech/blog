# Install the apt prerequisites
language: node_js
node_js:
  - node
addons:
  apt:
    packages:
      - python-pygments
cache:
  directories:
    - "node_modules"
    
# Clean and don't fail
install:
  - rm -rf public || exit 0

# Build the website
script:
  - npm install
  - npm run index
  - ../binaries/hugo -b https://blog.xlab.tech -v

deploy:
  provider: s3
  access_key_id: $AWS_ID
  secret_access_key: $AWS_TOKEN
  bucket: "blog.xlab.tech"
  skip_cleanup: true
  region: "eu-west-1"